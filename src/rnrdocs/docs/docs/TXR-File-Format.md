---
sidebar_position: 8
---

# Описание формата TXR

###### Date: 2018.11 | Version: 0.2 | Авторы: Александр Евдокимов

**Глоссарий**

**integer** - тип данных, целое положительное число.

**string** - тип данных, строка.

**Ссылки**

* Шаблон формата TXR для 010 Editor. [Открыть](https://github.com/AlexKimov/HardTruck-RignRoll-file-formats/blob/master/formats/templates/TXR.bt)
* [Скрипт 010 Editor](https://github.com/AlexKimov/HardTruck-RignRoll-file-formats/blob/master/scripts/TXRtoBMP.1sc) для конвертирования **.txr** файлов игры в формат .bmp (Дальнобойщики 2).

## Оглавление
**1.** [Введение](#Введение)

**2.** [Общая структура формата](#Общая-структура-формата)

**3.** [Секции](#Секции)

 **3.1** Заголовок файла

 **3.2** Информация о расположении секции с масками (16 битное изображение) 

 **3.3** Пиксельные данные 

 **3.4** Маски RGB (16 битное изображение) 

 **3.5** Mip карты (16 битное изображение)
  
## 1. Введение
Этот документ описывает структуру формата файла **TXR**, используемого в игре **Дальнобойщики Путь к Победе** и **Дальнобойщики 2 (Версия 8)**. Формат **TXR** содержит 8 битное изображение в формате TGA (Дальнобойщики 1) или 16 битное изображение (Дальнобойщики 2).

Все переменные, перечисленные в таблицах, показаны в порядке их следования в файле.

## 2. Общая структура формата
Формат **TXR** разделен на 2е (8 битное изображение) или 5ть (16 битное изображение) секций (см Табл. 1).

#### Таблица 1. Общая Структура
| №     | Секция                | Ссылки            | 
| :---- | :-------------------  | :---------------- |   
| **1** | Заголовок файла       | см. 3.1 Заголовок файла |
| **2** | Информация о расположении секций (16 битное изображение)  | см. Таблица 2  |
| **3** | Пиксельные данные     | см 3.3 Пиксельные данные | 
| **4** | PFRM / Маски RGB (16 битное изображение)  | см. Таблица 3 | 
| **5** | LVMP / Mip карты (16 битное изображение)  | см. Таблица 4  | 

## 3. Секции
### 3.1 Заголовок файла

Заголовок файла повторяет заголовок файла формата TGA. Размер заголовка равен 18 байт. [Подробнее](https://ru.wikipedia.org/wiki/Truevision_TGA)

### 3.2 Информация о расположении секций (16 битное изображение)

Секция присутствует только в файлах с 16 битным изображением и располагается сразу после заголовка. Хранит значение смещения в файле первой секции после пиксельных данных.

#### Таблица 2. Структура
| № | Тип данных   | Описание                          | Значение         |
| :-- | :------ | :----------------------------------- | :------------ |
| 1  | string  | Идентификатор LOFF  (4 байта) | "LOFF"  |
| 2  | integer  | Размер секции (4 байта)         | 4 |
| 3  | integer  | Смещении секции с масками ("PFRM") от начала файла (4 байта)  |  |

### 3.3 Пиксельные данные

**8 битное изображение**

Соответствует 8 битному изображению в формате **.tga**.  [Подробнее](https://ru.wikipedia.org/wiki/Truevision_TGA)

**16 битное изображение**

Пиксели хранятся в формате RGB по 16 бит на один пиксель изображения с масками для каждого цвета из секции **PFRM**.

### 3.4 Секция **PFRM** (16 битное изображение)

Секция присутствует только в файлах с 16 битным изображением и может располагаться сразу после пиксельных данных или после секции **LVMP**. Размер секции 36 байт.

#### Таблица 3. Cекция PFRM
| №     | Тип                | Описание    | 
| :---- | :-------------------  | :------------- | 
| **1** | string | Индификатор PFRM (4 байта)   |
| **2** | integer | Размер секции (4 байта)   |
| **3** |  | Маска для красного цвета (4 байта)   |
| **4** |  | Маска для зеленого цвета (4 байта)   |
| **5** |  | Маска для синего цвета (4 байта)   |
| **6** |  | Маска для альфа канала (4 байта)   |
| **7** |  | Остальные данные (пустые) (12 байт)   |

### 3.5 Секция LVMP

Секция содержит Мип-карты ([Статья на Википедия](https://ru.wikipedia.org/wiki/MIP-%D1%82%D0%B5%D0%BA%D1%81%D1%82%D1%83%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)) и состоит из заголовка размером 20 байт и следующих за ним секции пиксельных данных в виде уменьшенных копий основного изображения.

**3.5.1** Заголовок секции

#### Таблица 4. Структура заголовка
| № | Тип данных   | Описание                          | Значение         |
| :-- | :------ | :----------------------------------- | :------------ |
| 1 | string | Индификатор LVMP (4 байта)   |
| 2  | integer  | Размер секции (4 байта)  |   |
| 3  | integer  |  (4 байта)  |   |
| 4  | integer  | Ширина изображения (4 байта)  |   |
| 5  | integer  | Высота изображения (4 байта)  |   |
| 6  | integer  |  (4 байта)  |   |

**3.5.2** Пиксельные данные

Секция содержит уменьшенные копии изображения основного изображения (см **3.3 Пиксельные данные**) в формате RGB по 16 бит на пиксель. Изображения располагаются последовательно одно за другим без пропусков с уменьшением размеров каждого последующего в два раза. 